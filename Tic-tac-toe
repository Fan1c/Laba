import tkinter as tk
from tkinter import messagebox

current_player = "X"
board = [""] * 9
buttons = []


def create_game():
    window = tk.Tk()
    window.geometry('480x360')
    window.title("Крестики-нолики")
    window.resizable(False, False)


    game_frame = tk.Frame(window)
    game_frame.pack(pady=10)

    for i in range(3):
        for j in range(3):
            index = i * 3 + j
            button = tk.Button(game_frame, text="", font=("Arial", 20, "bold"),
                width=4, height=2, command=lambda idx=index: make_move(idx)
            )
            button.grid(row=i, column=j, padx=2, pady=2)
            buttons.append(button)

    global status_label
    status_label = tk.Label(
        window,
        text=f"Ход игрока: {current_player}",
        font=("Arial", 12),
        pady=10
    )
    status_label.pack()

    new_game_button = tk.Button(
        window,
        text="Новая игра",
        font=("Arial", 10),
        command=reset_game,

    )
    new_game_button.pack(pady=2)

    return window


def make_move(index):
    global current_player

    if board[index] == "" and not check_game_over():
        board[index] = current_player
        buttons[index].config(
            text=current_player,
            state="disabled"
        )
        if current_player == "X":
            buttons[index].config(fg="red")
        else:
            buttons[index].config(fg="blue")

        if check_winner():
            messagebox.showinfo("Победа!", f"Игрок {current_player} победил!")
            disable_all_buttons()
            status_label.config(text=f"Игрок {current_player} победил!")
        elif check_tie():
            messagebox.showinfo("Ничья!", "Игра закончилась вничью!")
            status_label.config(text="Ничья!")
        else:
            current_player = "O" if current_player == "X" else "X"
            status_label.config(text=f"Ход игрока: {current_player}")


def check_winner():
    winning_combinations = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8],
        [0, 3, 6], [1, 4, 7], [2, 5, 8],
        [0, 4, 8], [2, 4, 6]
    ]

    for combo in winning_combinations:
        if (board[combo[0]] == board[combo[1]] ==
                board[combo[2]] == current_player):
            for idx in combo:
                buttons[idx].config(bg="lightgreen")
            return True
    return False


def check_tie():
    return "" not in board and not check_winner()


def check_game_over():
    return check_winner() or check_tie()


def disable_all_buttons():
    for button in buttons:
        button.config(state="disabled")


def reset_game():
    global current_player, board
    current_player = "X"
    board = [""] * 9

    for button in buttons:
        button.config(
            text="",
            state="normal",
            bg="SystemButtonFace",
            fg="black"
        )

    status_label.config(text=f"Ход игрока: {current_player}")


def main():
    window = create_game()
    window.mainloop()


if __name__ == "__main__":
    main()
